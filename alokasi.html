<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
    <!-- File CSS utama -->
  <link rel="stylesheet" href="style.css" />

  <!-- Untuk icon jika mau pakai (opsional) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
</head>
<!-- PWA Meta Tags -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#007bff">
<body>
  <div id="app-alokasi">
    <h1>Alokasi Dana</h1>
    <form id="formAlokasi">
Â  <label>Dari Dompet:</label>
Â  <select id="fromDompet"></select>

Â  <label>Ke Dompet:</label>
Â  <select id="toDompet"></select>

Â  <input type="number" id="jumlahAlokasi" placeholder="Jumlah Dana" required />
Â  <button type="submit">Kirim Dana</button>
   </form>
        <!-- ========================= -->
    <!-- ðŸ‘‡ SECTION: NAVIGASI BAWAH -->
    <!-- ========================= -->
       <nav id="bottom-nav">
      <button onclick="location.href='index.html'">
        <i class="fas fa-bank"></i><br/>
        Bank Pusat
      </button>
      <button onclick="location.href='alokasi.html'">
        <i class="fas fa-exchange-alt"></i><br/>
        Alokasi
      </button>
      <button onclick="location.href='dompet.html'">
        <i class="fas fa-suitcase"></i><br/>
        Dompet
      </button>
      <button onclick="location.href='riwayat.html'">
        <i class="fas fa-history"></i><br/>
        Riwayat
      </button>
    </nav>
  </div>
  <script>
  // Register service worker (opsional)
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('service-worker.js')
        .catch(function(error) {
          console.log('SW registration failed:', error);
        });
    });
  }
</script>
</body>
<script>
  const fromDropdown = document.getElementById("fromDompet");
    const toDropdown = document.getElementById("toDompet");

    function updateDropdown() {
      const daftarDompet = JSON.parse(localStorage.getItem("daftarDompet")) || [];

      fromDropdown.innerHTML = '<option value="">-- Pilih Dompet --</option>';
      toDropdown.innerHTML = '<option value="">-- Pilih Dompet --</option>';

      daftarDompet.forEach((dompet, index) => {
        const option1 = document.createElement("option");
        option1.value = index;
        option1.textContent = `${dompet.nama} (Saldo: ${dompet.saldo})`;

        const option2 = document.createElement("option");
        option2.value = index;
        option2.textContent = `${dompet.nama} (Saldo: ${dompet.saldo})`;

        fromDropdown.appendChild(option1);
        toDropdown.appendChild(option2);
      });
    }

    // Jalankan saat halaman dimuat
    updateDropdown();

    document.getElementById("formAlokasi").addEventListener("submit", function (e) {
  e.preventDefault();

  const fromIndex = parseInt(fromDropdown.value);
  const toIndex = parseInt(toDropdown.value);
  const jumlah = parseFloat(document.getElementById("jumlahAlokasi").value);

  if (isNaN(fromIndex) || isNaN(toIndex)) {
    alert("Pilih dompet asal dan tujuan.");
    return;
  }

  if (fromIndex === toIndex) {
    alert("Dompet asal dan tujuan tidak boleh sama.");
    return;
  }

  const daftarDompet = JSON.parse(localStorage.getItem("daftarDompet")) || [];

  if (jumlah <= 0) {
    alert("Jumlah harus lebih dari 0.");
    return;
  }

  if (jumlah > daftarDompet[fromIndex].saldo) {
    alert("Saldo dompet asal tidak mencukupi.");
    return;
  }

  // Proses alokasi
  daftarDompet[fromIndex].saldo -= jumlah;
  daftarDompet[toIndex].saldo += jumlah;

  // Simpan kembali ke localStorage
  localStorage.setItem("daftarDompet", JSON.stringify(daftarDompet));

  // SIMPAN KE RIWAYAT TRANSAKSI
  simpanKeRiwayat(fromIndex, toIndex, jumlah, daftarDompet);

  alert("Dana berhasil dialokasikan!");
  updateDropdown();
  document.getElementById("formAlokasi").reset();
});

// Fungsi untuk simpan ke riwayat transaksi
function simpanKeRiwayat(fromIndex, toIndex, jumlah, daftarDompet) {
  let riwayat = JSON.parse(localStorage.getItem("riwayatTransaksi")) || [];
  
  const dataRiwayat = {
    tipe: "Alokasi",
    keterangan: `Dari ${daftarDompet[fromIndex].nama} ke ${daftarDompet[toIndex].nama}`,
    jumlah: jumlah,
    warna: "alokasi", // Bukan pengeluaran, cuma pemindahan
    tanggal: new Date().toLocaleDateString("id-ID"),
    detail: {
      sumber: `Dompet ${daftarDompet[fromIndex].nama}`,
      target: `Dompet ${daftarDompet[toIndex].nome}`,
      indexDompetAsal: fromIndex,
      indexDompetTujuan: toIndex,
      namaDompetAsal: daftarDompet[fromIndex].nama,
      namaDompetTujuan: daftarDompet[toIndex].nama
    }
  };
  
  riwayat.push(dataRiwayat);
  localStorage.setItem("riwayatTransaksi", JSON.stringify(riwayat));
}
</script>
</html>